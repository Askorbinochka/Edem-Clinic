<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Панель Адміністратора | EDEM Clinic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-body: #05070a;
            --bg-card: #0d111a;
            --accent: #00d2ff;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --text-main: #ffffff;
            --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
        }

        body { 
            background: var(--bg-body); 
            color: var(--text-main); 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(90deg, #0d111a 0%, #161b22 100%);
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        .admin-header h1 { margin: 0; font-size: 1.5rem; color: var(--accent); }

        .card { 
            background: var(--bg-card); 
            border: 1px solid var(--border); 
            border-radius: 16px; 
            padding: 24px; 
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h2 { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-size: 1.25rem; }
        h2 i { color: var(--accent); }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { color: var(--text-dim); font-weight: 500; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; }
        th, td { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); text-align: left; }
        tr:hover { background: rgba(255,255,255,0.02); }

        .btn { 
            padding: 10px 18px; 
            border-radius: 10px; 
            cursor: pointer; 
            border: none; 
            font-weight: 600; 
            transition: all 0.2s ease; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 0.85rem;
            color: white;
        }
        
        .btn-exit { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid var(--danger); }
        .btn-exit:hover { background: var(--danger); color: white; }
        .btn-ok { background: var(--success); }
        .btn-edit { background: rgba(0, 210, 255, 0.15); color: var(--accent); }
        .btn-del { background: rgba(239, 68, 68, 0.15); color: #ff6b6b; }
        .btn-del:hover { background: var(--danger); color: white; }

        .status { font-size: 0.75rem; padding: 4px 12px; border-radius: 50px; font-weight: bold; display: inline-block; }
        .pending { background: rgba(245, 158, 11, 0.15); color: var(--warning); border: 1px solid var(--warning); }
        .approved { background: rgba(16, 185, 129, 0.15); color: var(--success); border: 1px solid var(--success); }

        .empty-msg { text-align: center; padding: 40px; color: var(--text-dim); font-style: italic; }

        input {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #05070a;
            color: white;
            outline: none;
        }

        .grid-form {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="admin-header">
            <h1><i class="fas fa-user-shield"></i> EDEM Clinic Admin</h1>
            <button onclick="logout()" class="btn btn-exit">
                <i class="fas fa-sign-out-alt"></i> Вийти
            </button>
        </header>

        <div class="card">
            <h2><i class="fas fa-calendar-check"></i> Заявки на прийом</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Час</th>
                            <th>Пацієнт</th>
                            <th>Телефон</th>
                            <th>Лікар</th>
                            <th>Дії</th>
                        </tr>
                    </thead>
                    <tbody id="appsTableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-comment-dots"></i> Відгуки</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Автор</th>
                            <th>Відгук</th>
                            <th>Статус</th>
                            <th>Дії</th>
                        </tr>
                    </thead>
                    <tbody id="revsTableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-user-md"></i> Керування персоналом</h2>
            <form id="doctorForm" class="grid-form">
                <input type="hidden" id="docId">
                <input type="text" id="docName" placeholder="ПІБ" required>
                <input type="text" id="docRole" placeholder="Спеціалізація" required>
                <input type="text" id="docExp" placeholder="Стаж" required>
                <input type="text" id="docImg" placeholder="URL фото" required>
                <button type="submit" class="btn btn-ok" id="docBtn">Додати лікаря</button>
            </form>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Фото</th>
                            <th>Ім'я</th>
                            <th>Посада</th>
                            <th>Дії</th>
                        </tr>
                    </thead>
                    <tbody id="doctorsListBody"></tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-tags"></i> Керування прайс-листом</h2>
            <form id="priceForm" class="grid-form">
                <input type="hidden" id="priceId">
                <input type="text" id="priceName" placeholder="Назва послуги" required>
                <input type="text" id="priceValue" placeholder="Ціна" required>
                <button type="submit" class="btn btn-ok" id="priceBtn">Додати послугу</button>
            </form>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Послуга</th>
                            <th>Ціна</th>
                            <th>Дії</th>
                        </tr>
                    </thead>
                    <tbody id="pricesTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCMoz3O3WXCLibLw1_dSh5ZhMKYPK1C6WU",
            authDomain: "edem-bbad7.firebaseapp.com",
            databaseURL: "https://edem-bbad7-default-rtdb.firebaseio.com",
            projectId: "edem-bbad7",
            storageBucket: "edem-bbad7.firebasestorage.app",
            messagingSenderId: "900048422349",
            appId: "1:900048422349:web:84c4215d59698a81e3b084"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. Авторизація
        firebase.auth().onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = "index.html"; 
            } else {
                loadData();
            }
        });

        function logout() {
            if(confirm('Вийти з системи?')) {
                firebase.auth().signOut().then(() => {
                    window.location.href = "index.html";
                });
            }
        }

        // 2. Завантаження даних
        function loadData() {
            // Прайс з кнопкою редагування
            db.ref('prices').on('value', (snapshot) => {
                const body = document.getElementById('pricesTableBody');
                const data = snapshot.val();
                body.innerHTML = data ? Object.keys(data).map(id => `
                    <tr>
                        <td>${data[id].name}</td>
                        <td><strong>${data[id].price}</strong></td>
                        <td>
                            <button class="btn btn-edit" onclick="editPrice('${id}', '${data[id].name}', '${data[id].price}')"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-del" onclick="deleteItem('prices', '${id}')"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `).join('') : '<tr><td colspan="3" class="empty-msg">Прайс порожній</td></tr>';
            });

            // Заявки
            db.ref('appointments').on('value', (snapshot) => {
                const body = document.getElementById('appsTableBody');
                const data = snapshot.val();
                body.innerHTML = data ? Object.keys(data).map(id => `
                    <tr>
                        <td>${data[id].date || 'Не вказано'}</td>
                        <td><strong>${data[id].name}</strong></td>
                        <td>${data[id].phone}</td>
                        <td>${data[id].doctor || '-'}</td>
                        <td><button class="btn btn-del" onclick="deleteItem('appointments', '${id}')"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `).reverse().join('') : '<tr><td colspan="5" class="empty-msg">Немає заявок</td></tr>';
            });

            // Лікарі
            db.ref('doctors').on('value', (snapshot) => {
                const body = document.getElementById('doctorsListBody');
                const data = snapshot.val();
                body.innerHTML = data ? Object.keys(data).map(id => `
                    <tr>
                        <td><img src="${data[id].img}" width="40" height="40" style="border-radius:50%; object-fit:cover;"></td>
                        <td>${data[id].name}</td>
                        <td>${data[id].role}</td>
                        <td>
                            <button class="btn btn-edit" onclick="editDoctor('${id}', '${data[id].name}', '${data[id].role}', '${data[id].exp}', '${data[id].img}')"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-del" onclick="deleteItem('doctors', '${id}')"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `).join('') : '<tr><td colspan="4" class="empty-msg">Персонал не додано</td></tr>';
            });

            // Відгуки
            db.ref('reviews').on('value', (snapshot) => {
                const body = document.getElementById('revsTableBody');
                const data = snapshot.val();
                body.innerHTML = data ? Object.keys(data).map(id => {
                    const r = data[id];
                    const isPending = r.status === 'pending';
                    return `
                    <tr>
                        <td><strong>${r.name}</strong></td>
                        <td>${r.text}</td>
                        <td><span class="status ${isPending ? 'pending' : 'approved'}">${isPending ? '⏳' : '✅'}</span></td>
                        <td>
                            ${isPending ? `<button class="btn btn-ok" onclick="updateStatus('${id}', 'approved')"><i class="fas fa-check"></i></button>` : ''}
                            <button class="btn btn-del" onclick="deleteItem('reviews', '${id}')"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
                }).reverse().join('') : '<tr><td colspan="4" class="empty-msg">Немає відгуків</td></tr>';
            });
        }

        // --- Універсальні функції ---
        function deleteItem(path, id) {
            if(confirm('Видалити цей запис?')) db.ref(`${path}/${id}`).remove();
        }

        function updateStatus(id, newStatus) {
            db.ref(`reviews/${id}`).update({ status: newStatus });
        }

        // --- ЛОГІКА ПРАЙСУ ---
        const priceForm = document.getElementById('priceForm');
        priceForm.onsubmit = (e) => {
            e.preventDefault();
            const id = document.getElementById('priceId').value;
            const priceData = {
                name: document.getElementById('priceName').value,
                price: document.getElementById('priceValue').value
            };
            if (id) {
                db.ref('prices/' + id).update(priceData).then(() => alert('Оновлено!'));
            } else {
                db.ref('prices').push(priceData).then(() => alert('Додано!'));
            }
            priceForm.reset();
            document.getElementById('priceId').value = '';
            document.getElementById('priceBtn').innerText = 'Додати послугу';
        };

        function editPrice(id, name, price) {
            document.getElementById('priceId').value = id;
            document.getElementById('priceName').value = name;
            document.getElementById('priceValue').value = price;
            document.getElementById('priceBtn').innerText = 'Зберегти зміни';
            window.scrollTo({ top: document.getElementById('priceForm').offsetTop - 50, behavior: 'smooth' });
        }

        // --- ЛОГІКА ЛІКАРІВ ---
        const docForm = document.getElementById('doctorForm');
        docForm.onsubmit = (e) => {
            e.preventDefault();
            const id = document.getElementById('docId').value;
            const newDoc = {
                name: document.getElementById('docName').value,
                role: document.getElementById('docRole').value,
                exp: document.getElementById('docExp').value,
                img: document.getElementById('docImg').value
            };
            if (id) {
                db.ref('doctors/' + id).update(newDoc).then(() => alert('Оновлено!'));
            } else {
                db.ref('doctors').push(newDoc).then(() => alert('Додано!'));
            }
            docForm.reset();
            document.getElementById('docId').value = '';
            document.getElementById('docBtn').innerText = 'Додати лікаря';
        };

        function editDoctor(id, name, role, exp, img) {
            document.getElementById('docId').value = id;
            document.getElementById('docName').value = name;
            document.getElementById('docRole').value = role;
            document.getElementById('docExp').value = exp;
            document.getElementById('docImg').value = img;
            document.getElementById('docBtn').innerText = 'Зберегти зміни';
            window.scrollTo({ top: document.getElementById('doctorForm').offsetTop - 50, behavior: 'smooth' });
        }
    </script>
</body>
</html>
